notifications:
    email:
        recipients:
            - glance@acc.umu.se

# This makes us build on both linux and osx
os:
    - linux
    - osx

language:
    - cpp
    - objective-c

install:
    - if [ "$(uname)" = "Linux" ] && [ "$(lsb_release -r | cut -f 2-2)" = "12.04" ] ; then sudo add-apt-repository -y ppa:xav0989/libgit2 ; fi
    - if [ "$(uname)" = "Linux" ] ; then sudo apt-get update ; sudo apt-get install libqt4-dev qt4-qmake libxml2-dev libsqlite3-dev libxslt1-dev libzip-dev libusb-1.0-0-dev libmarble-dev libgit2-dev ; fi
    - if [ "$(uname)" = "Darwin" ] ; then brew install asciidoc libzip qt sqlite cmake libusb pkg-config libgit2 ; brew link --force sqlite ; fi
    - if [ "$(uname)" = "Darwin" ] ; then (
      git clone --depth 10 -b KDE/4.11 git://anongit.kde.org/marble ../marble/sources;
      mkdir ../marble/build;
      cd ../marble/build;
      cmake -DCMAKE_BUILD_TYPE=Debug -DQTONLY=TRUE -DCMAKE_INSTALL_PREFIX=/usr/local ../sources;
      cd src/lib;
      make;
      install_name_tool -id /usr/local/lib/`echo libmarblewidget.??.dylib` libmarblewidget.dylib;
      cp *dylib /usr/local/lib/;
      mkdir -p /usr/local/include/marble;
      cp $(find ../../../sources/src/lib -name '*.h') /usr/local/include/marble/;
      ) fi
    - git clone --depth 10 git://git.libdivecomputer.org/libdivecomputer.git ../libdivecomputer
    - ( cd ../libdivecomputer ; autoreconf -i && ./configure && make )

script:
    - qmake LIBDCDEVEL=1 V=1
    - if [ "$(uname)" = "Darwin" ] ; then make doc ; fi
    - make
    - if [ "$(uname)" = "Darwin" ] ; then sudo make mac-deploy ; fi
